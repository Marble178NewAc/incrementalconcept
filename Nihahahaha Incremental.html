<html>
    <head>
        <title>Nihahahaha</title>
        <style>
            .upgradebuttons {
                border-radius: 0.1cm;
                text-align: center;
            }
            .upgradebuttons:hover {
                background-color: #c2c2c2;
            }
            html {
                background-color: pink;
            }
            .currency {
                background-color:rgb(255, 210, 215);
                border-radius: 0.3cm;
                text-align: center;
            }
            hr {
                background-color: rgb(255, 175, 188);
                height: 0.3cm;
            }
            .machine {
                display: inline-block;
            }
            #prestige {
                display: block;
                margin-left: auto;
                margin-right: auto;
            }
        </style>
    </head>
    <body>
        <audio id="lol">
            <source src="Koyuki sound effects Nihahaha.mp3">
        </audio>
        <h1 id="nihahaha" class="currency">10 nihahahaha</h1>
        <h4 id="persec" class="currency">1 nihahahaha per sec</h4>
        <button id="upgrade" class="upgradebuttons">Add +0.45 to the Nihahahaha/s<br>Cost: 10 Nihahahahas</button>
        <button id="upgradeupgrade" class="upgradebuttons">Increase the amount of upgrade 1: +0<br>Cost: 100 Nihahahahas</button>
        <hr>
        <h1 id="kufufufu" class="currency">0 kufufufu</h1>
        <h4 id="multihaha" class="currency">Boosting nihahahaha by 1x</h4>
        <h2 class="machine">1st</h2>
        <h2 id="buying1" class="machine" style="margin-left: 10cm;">1</h2>
        <button id="machine1" class="machine, upgradebuttons" style="float: right; margin-top: 1.3%;">Buy Machine<br>Cost: 200 Nihahahahas</button>
        <br>
        <h2 class="machine">2nd</h2>
        <h2 class="machine" id="buying2" style="margin-left: 10cm;">1</h2>
        <button id="machine2" class="machine, upgradebuttons" style="float: right; margin-top: 1.3%;">Buy Machine<br>Cost: 10000 Nihahahaha</button>
        <script>
            const upgrade = document.getElementById("upgrade")
            const upgrade2 = document.getElementById("upgradeupgrade")
            const nihahahahaha = document.getElementById("nihahaha")
            const nihaperseco = document.getElementById("persec")
            var koyuki = 10
            var koyukipers = 0
            var cost = 10
            var bonus = 0
            var cost2 = 100
            var machines1 = 0
            var machines2 = 0
            var kufufufufufu = 0
            var multiniha = 1
            const STOPPED = Symbol.for("@@gameloop/stopped");
            const PAUSED = Symbol.for("@@gameloop/paused");
            const RUNNING = Symbol.for("@@gameloop/running");
            
            class GameLoop {
                constructor(options = {}) {
                    this.state = STOPPED;
            	    this.options = {
                        step: 1000 / 60,
                        maxUpdates: 300,
                        ...options
                    };
                
                    this.tick = this.tick.bind(this);
                }
                get isStopped() {
                    return this.state === STOPPED;
                }
                get isPaused() {
                    return this.state === PAUSED;
                }
                get isRunning() {
                    return this.state === RUNNING;
                }
                start() {
                    if (this.isStopped) {
                        this.state = RUNNING;
                        
                        const lag = 0;
                        const delta = 0;
                        const total = 0;
                        const last = null;
                        
                        this.timing = { last, total, delta, lag };
                        this.frame = requestAnimationFrame(this.tick);
                    }
                }
                stop() {
                    if (this.isRunning || this.isPaused) {
                        this.state = STOPPED;
                        cancelAnimationFrame(this.frame);
                    }
                }
                pause() {
                    if (this.isRunning) {
                        this.state = PAUSED;
                        cancelAnimationFrame(this.frame);
                    }
                }
                resume() {
                    if (this.isPaused) {
                        this.state = RUNNING;
                        this.frame = requestAnimationFrame(this.tick);
                    }
                }
                tick(time) {
                    if (this.timing.last === null) this.timing.last = time;
                    this.timing.delta = time - this.timing.last;
                    this.timing.total += this.timing.delta;
                    this.timing.lag += this.timing.delta;
                    this.timing.last = time;
                    
                    let numberOfUpdates = 0;
                    
                    while (this.timing.lag >= this.options.step) {
                        this.timing.lag -= this.options.step;
                        this.onUpdate(this.options.step, this.timing.total);
                        this.numberOfUpdates++;
                        if (this.numberOfUpdates >= this.options.maxUpdates) {
                            this.onPanic();
                            break;
                        }
                    }
                    
                    this.onRender(this.timing.lag / this.options.step);
                    
                    this.frame = requestAnimationFrame(this.tick);
                }
            }
            const loop = new GameLoop()
            loop.onUpdate = function(dt, t) {
                koyuki += (koyukipers * Math.max(1,multiniha)) / 1000 * dt
                kufufufufufu += (machines1 / 1000) * dt
                machines1 += (machines2 / 1000) * dt
                multiniha = Math.pow(kufufufufufu,0.5)
                save()
            }
            loop.onRender = function(i) {
                nihahahahaha.innerHTML = koyuki.toFixed(2) + " nihahahahas"
                nihaperseco.innerHTML = (koyukipers * Math.max(1,multiniha)).toFixed(2) + " nihahahaha per sec"
                upgrade.innerText = "Add +" + (1 + bonus).toFixed(1) + " to the Nihahahaha/s\nCost: " + Math.floor(cost) + " Nihahahahas"
                if (cost >= 20) {
                    upgrade2.style.display = "block"
                }
                else {
                    upgrade2.style.display = "none"
                }
                upgrade2.innerText = "Increase the amount of upgrade 1 by +0.4: +" + bonus.toFixed(1) + "\nCost: " + Math.floor(cost2) + " Nihahahahas"
                document.getElementById("buying1").innerHTML = machines1.toFixed(2)
                document.getElementById("buying2").innerHTML = machines2
                document.getElementById("kufufufu").innerHTML = kufufufufufu.toFixed(2) + " kufufufu"
                document.getElementById("multihaha").innerHTML = "Boosting nihahahaha by " + Math.max(1,multiniha) + "x"
            }
            upgrade.addEventListener("click", event => {
                if (koyuki >= Math.floor(cost)) {
                    koyuki -= Math.floor(cost)
                    koyukipers += (1 + bonus)
                    cost *= 1.2
                    // document.getElementById("lol").play()
                }
            })
            upgrade2.addEventListener("click", event => {
                if (koyuki >= Math.floor(cost2)) {
                    koyuki -= Math.floor(cost2)
                    bonus += 0.4
                    cost2 *= 1.5
                    // document.getElementById("lol").play()
                }
            })
            document.getElementById("machine1").addEventListener("click", event => {
                if (koyuki >= 200) {
                    koyuki -= 200
                    machines1++
                }
            })
            document.getElementById("machine2").addEventListener("click", event => {
                if (koyuki >= 10000) {
                    koyuki -= 10000
                    machines2++
                }
            })
            loop.start()
            const pageAccessedByReload = (
            (window.performance.navigation && window.performance.navigation.type === 1) || window.performance
                    .getEntriesByType('navigation')
                    .map((nav) => nav.type)
                    .includes('reload')
            );
            function save() {
                var save = {
                    currency: koyuki,
                    currency2: kufufufufufu,
                    multiplier: multiniha,
                    cost: cost,
                    cost2: cost2,
                    bonus: bonus,
                    machine1: machines1,
                    machine2: machines2,
                    persecond: koyukipers
                }
                localStorage.setItem("save",JSON.stringify(save));
            }
            function load() {
                var savegame = JSON.parse(localStorage.getItem("save"));
                if (typeof savegame.currency !== "undefined") koyuki = savegame.currency;
                if (typeof savegame.currency2 !== "undefined") kufufufufufu = savegame.currency2;
                if (typeof savegame.multiplier !== "undefined") multiniha = savegame.multiplier;
                if (typeof savegame.cost !== "undefined") cost = savegame.cost;
                if (typeof savegame.cost2 !== "undefined") cost2 = savegame.cost2;
                if (typeof savegame.bonus !== "undefined") bonus = savegame.bonus;
                if (typeof savegame.machine1 !== "undefined") machines1 = savegame.machine1;
                if (typeof savegame.machine2 !== "undefined") machines2 = savegame.machine2;
                if (typeof savegame.persecond !== "undefined") koyukipers = savegame.persecond;
            }
            if(pageAccessedByReload) {
                load()
            }
            else {
                load()
            }
        </script>
    </body>
</html>