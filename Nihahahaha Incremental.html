<html>
    <head>
        <title>Nihahahaha</title>
        <style>
            .upgradebuttons {
                border-radius: 0.1cm;
                text-align: center;
            }
            .upgradebuttons:hover {
                background-color: #8a8a8a;
            }
            html {
                background-color: pink;
            }
            .currency {
                background-color:rgb(255, 210, 215);
                border-radius: 0.3cm;
                text-align: center;
            }
            hr {
                background-color: rgb(255, 175, 188);
                height: 0.3cm;
            }
            .machine {
                display: inline-block;
            }
            #presbutton {
                display: block;
                margin-left: auto;
                margin-right: auto;
            }
            .presupgrade {
                width: 10cm;
                height: 5cm;
                font-size: 1cm;
                border-width: 0.1cm;
                border-radius: 0.1cm;
            }
            .presupgrade:hover {
                background-color: #8a8a8a;
            }
        </style>
    </head>
    <body>
        <audio id="lol">
            <source src="Koyuki sound effects Nihahaha.mp3">
        </audio>
        <h1 id="nihahaha" class="currency">10 nihahahaha</h1>
        <h4 id="persec" class="currency">1 nihahahaha per sec</h4>
        <button id="upgrade" class="upgradebuttons">Add +0.45 to the Nihahahaha/s<br>Cost: 10 Nihahahahas</button>
        <button id="upgradeupgrade" class="upgradebuttons">Increase the amount of upgrade 1: +0<br>Cost: 100 Nihahahahas</button>
        <button id="boostupgrade" class="upgradebuttons">Drains Atsui in return of multiplier for machine (10 atsui per 1x)<br>Multiplier: 1x</button>
        <hr>
        <h1 id="kufufufu" class="currency">0 kufufufu</h1>
        <h4 id="multihaha" class="currency">Boosting nihahahaha by 1x</h4>
        <h2 class="machine">1st</h2>
        <h2 class="machine" id="buying1" style="margin-left: 10cm;">1</h2>
        <button id="machine1" class="machine, upgradebuttons" style="float: right; margin-top: 1.3%;">Buy Machine<br>Cost: 200 Nihahahahas</button>
        <br>
        <h2 class="machine">2nd</h2>
        <h2 class="machine" id="buying2" style="margin-left: 10cm;">1</h2>
        <button id="machine2" class="machine, upgradebuttons" style="float: right; margin-top: 1.3%;">Buy Machine<br>Cost: 10K Nihahahahas</button>
        <br>
        <h2 class="machine">3rd</h2>
        <h2 class="machine" id="buying3" style="margin-left: 10cm;">1</h2>
        <button id="machine3" class="machine, upgradebuttons" style="float: right; margin-top: 1.3%;">Buy Machine<br>Cost: 1M Nihahahahas</button>
        <br>
        <h2 class="machine" id="title4">4th</h2>
        <h2 class="machine" id="buying4" style="margin-left: 10cm;">1</h2>
        <button id="machine4" class="machine, upgradebuttons" style="float: right; margin-top: 1.3%;">Buy Machine<br>Cost: 100M Nihahahaha</button>
        <hr>
        <h1 id="prestextreal" class="currency">0 prestiges</h1>
        <h1 id="prestext" class="currency">0 atsuis</h1>
        <button id="presbutton" class="upgradebuttons">Prestige!<br>Reach 1M Nihahahaha</button>
        <button id="presup1" class="presupgrade">Unlock boost machines upgrade<br>Cost: 10 atsui</button>
        <button id="presup2" class="presupgrade">Unlock 4th kufufufu machine<br>Cost: 100 atsui</button>
        <script>
            const upgrade = document.getElementById("upgrade")
            const upgrade2 = document.getElementById("upgradeupgrade")
            const nihahahahaha = document.getElementById("nihahaha")
            const nihaperseco = document.getElementById("persec")
            var koyuki = 10
            var koyukipers = 0
            var highestkoyuki = 0
            var cost = 10
            var bonus = 0
            var cost2 = 100
            var cost3 = 10
            var machines1 = 0
            var machines2 = 0
            var machines3 = 0
            var machines4 = 0
            var kufufufufufu = 0
            var multiniha = 1
            var prestige = 0
            var prestigemount = 0
            var disabled1 = 0
            var disabled2 = 0
            var bost = 0
            var boost = 0
            var presmount = Math.floor(highestkoyuki / 1e6)
            const STOPPED = Symbol.for("@@gameloop/stopped");
            const PAUSED = Symbol.for("@@gameloop/paused");
            const RUNNING = Symbol.for("@@gameloop/running");
            
            class GameLoop {
                constructor(options = {}) {
                    this.state = STOPPED;
            	    this.options = {
                        step: 1000 / 60,
                        maxUpdates: 300,
                        ...options
                    };
                
                    this.tick = this.tick.bind(this);
                }
                get isStopped() {
                    return this.state === STOPPED;
                }
                get isPaused() {
                    return this.state === PAUSED;
                }
                get isRunning() {
                    return this.state === RUNNING;
                }
                start() {
                    if (this.isStopped) {
                        this.state = RUNNING;
                        
                        const lag = 0;
                        const delta = 0;
                        const total = 0;
                        const last = null;
                        
                        this.timing = { last, total, delta, lag };
                        this.frame = requestAnimationFrame(this.tick);
                    }
                }
                stop() {
                    if (this.isRunning || this.isPaused) {
                        this.state = STOPPED;
                        cancelAnimationFrame(this.frame);
                    }
                }
                pause() {
                    if (this.isRunning) {
                        this.state = PAUSED;
                        cancelAnimationFrame(this.frame);
                    }
                }
                resume() {
                    if (this.isPaused) {
                        this.state = RUNNING;
                        this.frame = requestAnimationFrame(this.tick);
                    }
                }
                tick(time) {
                    if (this.timing.last === null) this.timing.last = time;
                    this.timing.delta = time - this.timing.last;
                    this.timing.total += this.timing.delta;
                    this.timing.lag += this.timing.delta;
                    this.timing.last = time;
                    
                    let numberOfUpdates = 0;
                    
                    while (this.timing.lag >= this.options.step) {
                        this.timing.lag -= this.options.step;
                        this.onUpdate(this.options.step, this.timing.total);
                        this.numberOfUpdates++;
                        if (this.numberOfUpdates >= this.options.maxUpdates) {
                            this.onPanic();
                            break;
                        }
                    }
                    
                    this.onRender(this.timing.lag / this.options.step);
                    
                    this.frame = requestAnimationFrame(this.tick);
                }
            }
            const loop = new GameLoop()
            loop.onUpdate = function(dt, t) {
                koyuki += ((koyukipers * Math.max(1,multiniha)) / (1000 / (prestigemount + 1))) * dt
                kufufufufufu += (machines1 / 1000) * dt
                machines1 += ((machines2 / 1000) * (boost + 1)) * dt
                machines2 += ((machines3 / 1000) * (boost + 1)) * dt
                machines3 += ((machines4 / 1000) * (boost + 1)) * dt
                multiniha = Math.pow(kufufufufufu,0.5)
                if (koyuki > highestkoyuki) {
                    highestkoyuki = koyuki
                }
                presmount = Math.floor(highestkoyuki / 1e6)
                save()
            }
            loop.onRender = function(i) {
                nihahahahaha.innerHTML = koyuki.toFixed(2) + " nihahahahas"
                nihaperseco.innerHTML = ((koyukipers * Math.max(1,multiniha)) * (prestigemount + 1)).toFixed(2) + " nihahahaha per sec"
                upgrade.innerText = "Add +" + (1 + bonus).toFixed(1) + " to the Nihahahaha/s\nCost: " + Math.floor(cost) + " Nihahahahas"
                if (cost >= 20) {
                    upgrade2.style.display = "block"
                }
                else {
                    upgrade2.style.display = "none"
                }
                upgrade2.innerText = "Increase the amount of upgrade 1 by +0.4: +" + bonus.toFixed(1) + "\nCost: " + Math.floor(cost2) + " Nihahahahas"
                if (bost == 1) {
                    document.getElementById("boostupgrade").style.display = "block"
                }
                else if (bost == 0) {
                    document.getElementById("boostupgrade").style.display = "none"
                }
                document.getElementById("buying1").innerHTML = machines1.toFixed(0)
                document.getElementById("buying2").innerHTML = machines2.toFixed(0)
                document.getElementById("buying3").innerHTML = machines3.toFixed(0)
                document.getElementById("buying4").innerHTML = machines4
                document.getElementById("kufufufu").innerHTML = kufufufufufu.toFixed(2) + " kufufufu"
                document.getElementById("multihaha").innerHTML = "Boosting nihahahaha by " + Math.max(1,multiniha).toFixed(2) + "x"
                if (highestkoyuki >= 1e6) {
                    document.getElementById("presbutton").style.display = "block"
                }
                else {
                    document.getElementById("presbutton").style.display = "none"
                }
                document.getElementById("presbutton").innerText = "Gain " + presmount + " atsui!\nReach " + presmount + "M Nihahahaha"
                if (prestige === 1) {
                    document.getElementById("prestext").innerHTML = Math.floor(prestige) + " atsui"
                }
                else {
                    document.getElementById("prestext").innerHTML = Math.floor(prestige) + " atsuis"
                }
                if (prestigemount === 1) {
                    document.getElementById("prestextreal").innerHTML = Math.floor(prestigemount) + " prestige"
                }
                else {
                    document.getElementById("prestextreal").innerHTML = Math.floor(prestigemount) + " prestiges"
                }
                if (disabled1 == 1) {
                    document.getElementById("presup1").disabled = true;
                    document.getElementById("presup1").innerText = "Unlock boost machines upgrade\nBought"
                }
                else {
                    document.getElementById("presup1").disabled = false;
                    document.getElementById("presup1").innerText = "Unlock boost machines upgrade\nCost: 10 atsuis"
                }
                if (disabled2 == 1) {
                    document.getElementById("title4").style.display = "inline-block"
                    document.getElementById("buying4").style.display = "inline-block"
                    document.getElementById("machine4").style.display = "inline-block"
                    document.getElementById("presup2").disabled = true
                    document.getElementById("presup2").innerText = "Unlock 4th kufufufu machine\nBought"
                }
                else {
                    document.getElementById("title4").style.display = "none"
                    document.getElementById("buying4").style.display = "none"
                    document.getElementById("machine4").style.display = "none"
                    document.getElementById("presup2").disabled = false
                    document.getElementById("presup2").innerText = "Unlock 4th kufufufu machine\nCost: 100 atsui"
                }
                document.getElementById("boostupgrade").innerText = "Drains Atsui in return of multiplier for machine (" + cost3 + " atsui per +0.1x)\nMultiplier: " + (boost + 1).toFixed(1) + "x"
            }
            upgrade.addEventListener("click", event => {
                if (koyuki >= Math.floor(cost)) {
                    koyuki -= Math.floor(cost)
                    koyukipers += (1 + bonus)
                    cost *= 1.2
                   /// document.getElementById("lol").play()
                }
            })
            upgrade2.addEventListener("click", event => {
                if (koyuki >= Math.floor(cost2)) {
                    koyuki -= Math.floor(cost2)
                    bonus += 0.4
                    cost2 *= 1.5
                   // document.getElementById("lol").play()
                }
            })
            document.getElementById("boostupgrade").addEventListener("click", event => {
                if (prestige >= cost3) {
                    prestige -= cost3
                    boost += 0.1
                    cost3 *= 2
                }
            })
            document.getElementById("machine1").addEventListener("click", event => {
                if (koyuki >= 200) {
                    koyuki -= 200
                    machines1++
                  //  document.getElementById("lol").play()
                }
            })
            document.getElementById("machine2").addEventListener("click", event => {
                if (koyuki >= 10000) {
                    koyuki -= 10000
                    machines2++
                  //  document.getElementById("lol").play()
                }
            })
            document.getElementById("machine3").addEventListener("click", event => {
                if (koyuki >= 1e6) {
                    koyuki -= 1e6
                    machines3++
                }
            })
            document.getElementById("machine4").addEventListener("click", event => {
                if (koyuki >= 1e8) {
                    koyuki -= 1e8
                    machines4++
                }
            })
            document.getElementById("presbutton").addEventListener("click", event => {
                koyuki = 10
                koyukipers = 0
                highestkoyuki = 0
                cost = 10
                bonus = 0
                cost2 = 100
                machines1 = 0
                machines2 = 0
                machines3 = 0
                machines4 = 0
                kufufufufufu = 0
                prestige = prestige + presmount
                prestigemount++
              //  document.getElementById("lol").play()
            })
            document.getElementById("presup1").addEventListener("click", event => {
                if (prestige >= 10 && disabled1 == 0) {
                    prestige -= 10
                    document.getElementById("presup1").disabled = true
                    disabled1 = 1
                    bost = 1
                }
            })
            document.getElementById("presup2").addEventListener("click", event => {
                if (prestige >= 100 && disabled2 == 0) {
                    prestige -= 100
                    document.getElementById("presup2").disabled = true
                    disabled2 = 1
                }
            })
            loop.start()
            const pageAccessedByReload = (
            (window.performance.navigation && window.performance.navigation.type === 1) || window.performance
                    .getEntriesByType('navigation')
                    .map((nav) => nav.type)
                    .includes('reload')
            );
            function save() {
                var save = {
                    currency: koyuki,
                    currency2: kufufufufufu,
                    multiplier: multiniha,
                    cost: cost,
                    cost2: cost2,
                    cost3: cost3,
                    bonus: bonus,
                    machine1: machines1,
                    machine2: machines2,
                    machine3: machines3,
                    machine4: machines4,
                    persecond: koyukipers,
                    prestige: prestige,
                    prestigeamount: prestigemount,
                    bost: bost,
                    disabled1: disabled1,
                    disabled2: disabled2,
                    boost: boost
                }
                localStorage.setItem("save",JSON.stringify(save));
            }
            function load() {
                var savegame = JSON.parse(localStorage.getItem("save"));
                if (typeof savegame.currency !== "undefined") koyuki = savegame.currency;
                if (typeof savegame.currency2 !== "undefined") kufufufufufu = savegame.currency2;
                if (typeof savegame.multiplier !== "undefined") multiniha = savegame.multiplier;
                if (typeof savegame.cost !== "undefined") cost = savegame.cost;
                if (typeof savegame.cost2 !== "undefined") cost2 = savegame.cost2;
                if (typeof savegame.cost3 !== "undefined") cost3 = savegame.cost3;
                if (typeof savegame.bonus !== "undefined") bonus = savegame.bonus;
                if (typeof savegame.machine1 !== "undefined") machines1 = savegame.machine1;
                if (typeof savegame.machine2 !== "undefined") machines2 = savegame.machine2;
                if (typeof savegame.machine3 !== "undefined") machines3 = savegame.machine3;
                if (typeof savegame.machine4 !== "undefined") machines4 = savegame.machine4;
                if (typeof savegame.persecond !== "undefined") koyukipers = savegame.persecond;
                if (typeof savegame.prestige !== "undefined") prestige = savegame.prestige;
                if (typeof savegame.prestigeamount !== "undefined") prestigemount = savegame.prestigeamount;
                if (typeof savegame.bost !== "undefined") bost = savegame.bost;
                if (typeof savegame.disabled1 !== "undefined") disabled1 = savegame.disabled1;
                if (typeof savegame.disabled2 !== "undefined") disabled2 = savegame.disabled2;
                if (typeof savegame.boost !== "undefined") boost = savegame.boost;
            }
            if(pageAccessedByReload) {
                load()
            }
            else {
                load()
            }
        </script>
    </body>
</html>
